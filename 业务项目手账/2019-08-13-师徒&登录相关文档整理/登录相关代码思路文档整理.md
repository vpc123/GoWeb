#### 登录相关代码思路整理-业务向

##### 作者:流火夏梦

###### 时间:2019-08-13

根据用户的相关登录进行信息验证，判断用户是否已经实名认证，为了方便经纪人用户的绩效奖金和工作发放通知，相关代码的整理思路如下:

业务流程一：

用户通过账号登录系统，根据信息查询判断是否是当前用户，是否需要进行实名认证或者进行二次实名认证

原因如下:

        目前系统的账号分为userid，用户名，马甲名，身份证进行区分用户，userid在整个系统的维度唯一确认，但是因为账号的分布和部署实现进行项目的区分，所以马甲是相对门店维度的区分，更具体来说userid+马甲针对的是门店维度，但是身份证信息是从经济人的个人维度进行划分的，用户的经济绩效也应该是按照身份证给进行统计发放。目前系统针对的三个维度依次，管理系统-门店-个人三个维度彼此分离但又相互相关。

> 场景1-身份证认证：

用户首次登录系统,判断用户的真实归属，是否需要进行二次的身份认证相关信息，我们通过认证的方式进行用户对系统的绑定，用户如果不是系统已经存在的用户真实信息，进行认证。当前用户进行认证，输入姓名和真实姓名进行认证，后台进行的处理逻辑如下，根据当前用户查找当前用户是否存在相关的认证信息。因为此账号可能之前分配给的用户进行身份认证，所以外键存在不为空的可能性，进一步判断身份证的具体验证信息。第一种情况:如果账号没有对应的身份证信息表中的数据，直接新增一条相关的用户认证信息并更新用户表绑定对应关系。第二种情况:当前账号之前实名认证过其他人的实名认证信息存在，新的用户需要绑定并进行二次认证，需要进行判断用户是否在职，在职并且二次认证的身份证信息与第一次完全一致，只需要更新即可，否则新增用户认证记录；第三种情况:用户接管其他项目组的成员账号进行登录，上次行号没有实名认证；第四种情况:用户两次入职,或者输入身份证认证信息同前一次不同，则新增新的认证信息并更新绑定认证记录(身份证信息比对时会进行身份证号的校验和比对,身份证号二次比对时需要全部转小写进行比较因为身份证号存在英文字母的特殊情况，X或者x我们一律转成小写判断，前端用户可能会进行大小写不区分的输入)。

> 场景2-获取登录用户的真实姓名：

用户相关信息的显示，当经纪人用户登录管理平台的时候，需要显示并展示用户列表相关信息的数据展示，通过前端的传递会员的userid或者唯一标识进行相关的查询，出于安全的相关点考虑最好使用底层的查询进行参数传递，这样就不会发生用户登录的账号信息登录，通过账号的id很多地方都可能获取机密的信息数据，所有最好不要使用userid的直接明文进行数据展示和数据传递。后台获取uid通过展示数据的方式进行数据的查询方向查询数据的具体加密信息数据。

> 场景3-身份证&银行卡信息绑定:

身份证绑定需要查询用户是否存在有效的身份认证并且用户的状态目前处于在职，才可以进行认证否则认证信息不可以获取查询相关的判断条件信息。通过uid转换对应的userid->user表中进行查询对应的idcardid->查询对应的身份证号码是否存在，如果存在则直接追加银行卡密码信息数据，否则不允许进行银行卡绑定，由前台提醒用户前去进行身份证实名认证，之后完成银行卡信息绑定。

注意点:身份证号码包含英文，全部转换成为小写进行对比！



> 总结:

会员相关的登录知识点针对整个系统建设的完成只是冰山一角，但是确实web系统入门的建设时期，通过描述和构造用户登录相关功能测试点，深入了解某一个行业的具体业务，也可以从登录系统管中窥豹几分。用户系统的登录还有账号回收循环利用的方面，全面宏观的了解账号体系对于一个业务系统的使能作用。在第一次书写业务功能的时候，对于系统参数的比如身份证对比校验问题，由于后台系统无法完全校验用户的行为习惯逻辑功能测试平台。
